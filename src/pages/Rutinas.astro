---
import Layout from "../layouts/Layout.astro";
import NavBar from "../components/NavBar.astro";
import "../styles/gesEjercicios.css";
---

<Layout>
  <main id="main-vista-rutina">
    <section class="contenedor-rutina">
      <h1>Tus Rutinas Personalizadas</h1>
      <div id="info-usuario"></div>
      <button id="btn-crear-rutina">Crea una rutina</button>
      <div id="div-rutinas"></div>
    </section>

    <!-- Diálogo para crear rutina -->
    <dialog id="dialog-crear-rutina" class="dialog-crear-rutina">
      <form
        method="dialog"
        id="form-crear-rutina"
        class="dialog-crear-rutina"
      >
        <h2>Crea una rutina</h2>
        <label for="nombre-rutina">Nombre de la rutina:</label>
        <input type="text" id="nombre-rutina" required />
        <label for="dias-semana">Selecciona los días de la semana:</label>
        <select id="dias-semana" multiple required>
          <option value="Lunes">Lunes</option>
          <option value="Martes">Martes</option>
          <option value="Miércoles">Miércoles</option>
          <option value="Jueves">Jueves</option>
          <option value="Viernes">Viernes</option>
          <option value="Sábado">Sábado</option>
          <option value="Domingo">Domingo</option>
        </select>
        <button type="submit" id="btn-crear-rutina-confirmar">Crear Rutina</button>
      </form>
      <button id="btn-cerrar-dialogo">Cerrar</button>
    </dialog>
  </main>

  <script type="module">
    // Obtener elementos del DOM
    const btnCrearRutina = document.getElementById("btn-crear-rutina");
    const dialogoCrearRutina = document.getElementById("dialog-crear-rutina");
    const btnCerrarDialogo = document.getElementById("btn-cerrar-dialogo");
    const formCrearRutina = document.getElementById("form-crear-rutina");
    const divRutinas = document.getElementById("div-rutinas");

    // Abrir el diálogo al hacer clic en el botón "Crear una rutina"
    btnCrearRutina.addEventListener("click", () => {
      dialogoCrearRutina.showModal(); // Abre el diálogo
    });

    // Cerrar el diálogo al hacer clic en el botón "Cerrar"
    btnCerrarDialogo.addEventListener("click", () => {
      dialogoCrearRutina.close(); // Cierra el diálogo
    });

    // Manejar el envío del formulario
    formCrearRutina.addEventListener("submit", async (e) => {
      e.preventDefault();

      const nombreRutina = document.getElementById("nombre-rutina").value;
      const diasSeleccionados = Array.from(
        document.getElementById("dias-semana").selectedOptions
      ).map(option => option.value);

      // Validación simple (se puede personalizar según necesidades)
      if (!nombreRutina || diasSeleccionados.length === 0) {
        alert("Por favor, completa todos los campos.");
        return;
      }

      // Crear un objeto con los datos de la rutina
      const nuevaRutina = {
        nombre: nombreRutina,
        dias: diasSeleccionados,
      };

      // Aquí podrías hacer una llamada a la API para guardar la rutina en la base de datos
      console.log("Nueva rutina creada:", nuevaRutina);

      // Cerrar el diálogo
      dialogoCrearRutina.close();

      // Opcional: Mostrar la nueva rutina en la interfaz de usuario
      divRutinas.innerHTML += `
        <div class="dia-rutina">
          <h2>Rutina: ${nuevaRutina.nombre}</h2>
          <p>Días seleccionados: ${nuevaRutina.dias.join(", ")}</p>
        </div>
      `;
    });
  </script>

  <style>
    #main-vista-rutina {
      padding: 2rem;
      background-color: var(--background);
      color: var(--white);
    }

    .contenedor-rutina {
      max-width: 800px;
      margin: auto;
    }

    .info-usuario {
      background: var(--gray);
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 2rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    .dia-rutina {
      background: var(--gray-light);
      padding: 1rem;
      margin-bottom: 2rem;
      border-radius: 10px;
      border-left: 5px solid var(--red);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .dia-rutina h2 {
      color: var(--red);
    }

    #dialog-crear-rutina {
      padding: 1rem;
      background-color: var(--background);
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    button {
      padding: 0.5rem 1rem;
      background-color: var(--red);
      color: white;
      border: none;
      border-radius: 5px;
    }

    select {
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 1rem;
      border-radius: 5px;
    }

    input {
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 1rem;
      border-radius: 5px;
    }
  </style>
</Layout>
